import{u as y,_ as x}from"./asyncData.sW88j4Uv.js";import{g as h,o as a,c as t,a as o,t as p,b as _,h as n,d as k,i as w,j as T,k as E,r as B,l as C,F as L}from"./entry.Bn6fpZtb.js";import{i,u as f}from"./useFetchHandler.GoSQu35s.js";import{b as l}from"./constants.Cn0qLSFg.js";const R=""+globalThis.__publicAssetsURL("images/thumbnail-courses.svg"),D={class:"flex justify-between items-center"},F={class:"font-bold text-4xl py-5"},N={class:"flex w-full border rounded-md border-gray-950 bg-gray-800 p-2 mb-5"},U={class:"grid grid-cols-1"},A=o("h1",{class:"font-semibold text-xl"},"Descrição",-1),O=o("div",null,[o("img",{src:R,class:"sm:w-full"})],-1),P=h({__name:"course",props:{id:Number,name:String,description:String,author:String,isSubscribe:Boolean,actionSubscribe:Function},setup(m){const e=m;return(c,u)=>{const d=w;return a(),t("div",null,[o("div",D,[o("h1",F,p(e.name),1),_(d,{loading:"isLoading"in c?c.isLoading:n(i),color:"indigo",label:e.isSubscribe?"Desinscrever":"Inscrever",onClick:e.actionSubscribe},null,8,["loading","label","onClick"])]),o("div",N,[o("div",U,[A,k(" "+p(e.description),1)])]),O])}}}),V={key:0},j={key:1},G={key:2},J=h({__name:"index",setup(m){const e=T(),c=E.value,{data:u,pending:d,error:g}=y("courses-subscribe",async()=>{const[s,b]=await Promise.all([$fetch(`${l}/courses/id/${e.params.id}`,{method:"GET",credentials:"include"}),$fetch(`${l}/courses/subscribe/user/${c.id}`,{method:"GET",credentials:"include"})]);return{course:s,subscribe:b}}),r=B(!1);C(async()=>{await u.value.subscribe.map(s=>{s.course_id==e.params.id&&(r.value=!0)})});const v=async()=>{if(r.value)return i.value=!0,await $fetch(`${l}/courses/unsubscribe/${e.params.id}`,{method:"POST",credentials:"include",onResponseError:s=>f(s.response._data.error)}),i.value=!1,r.value=!1;if(!r.value)return i.value=!0,await $fetch(`${l}/courses/subscribe/${e.params.id}`,{method:"POST",credentials:"include",onResponseError:s=>f(s.response._data.error)}),i.value=!1,r.value=!0};return(s,b)=>{const $=x,S=P;return a(),t(L,null,[_($),n(d)?(a(),t("div",V," Carregando... ")):n(g)?(a(),t("div",j," Ocorreu algum problema de conexão. Tente novamente ")):(a(),t("div",G,[_(S,{name:n(u).course.name,description:n(u).course.description,"is-subscribe":n(r),"action-subscribe":v},null,8,["name","description","is-subscribe"])]))],64)}}});export{J as default};
